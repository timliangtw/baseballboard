<!DOCTYPE html>
<html lang="zh-Hant">

<head>
  <meta charset="UTF-8" />
  <title>棒球棋 V5: 經典還原版</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="style.css">
</head>

<body>

  <div id="start-screen" class="overlay-screen">
    <div class="title-logo">BASEBALL BATTLE</div>
    <button class="menu-btn primary" onclick="goToSetup()">開始對戰</button>
    <button class="menu-btn" onclick="showGallery()">卡牌圖鑑</button>
  </div>

  <div id="gallery-screen" class="overlay-screen hidden">
    <div style="display:flex; justify-content:space-between; width:90%; max-width:800px; margin-bottom:10px;">
      <h2 style="color:var(--accent-color);">卡牌圖鑑</h2>
      <button class="menu-btn" style="width:100px; padding:5px; font-size:1rem;" onclick="closeGallery()">返回</button>
    </div>
    <div class="gallery-grid" id="gallery-content"></div>
  </div>

  <div id="setup-screen" class="overlay-screen hidden">
    <div class="setup-container">
      <h2 style="margin-bottom:20px;">賽前準備</h2>

      <div id="step-color">
        <div style="display:flex; justify-content:space-between;">
          <div style="text-align:center;">
            <div>P1 (客隊)</div>
            <div class="color-picker-row" id="p1-colors"></div>
          </div>
          <div style="width:2px; background:#444;"></div>
          <div style="text-align:center;">
            <div>P2 (主隊)</div>
            <div class="color-picker-row" id="p2-colors"></div>
          </div>
        </div>
        <button class="menu-btn primary" onclick="goToInitiative()">確認顏色</button>
      </div>

      <div id="step-initiative" style="display:none;">
        <h3>比大小決定主客場</h3>
        <p style="font-size:0.8rem; color:#aaa;">數字大者為主隊(後攻)</p>
        <div class="initiative-area">
          <div class="player-setup-box">
            <div>P1</div>
            <div class="roll-num" id="p1-roll">-</div>
            <button class="menu-btn" style="width:80px; font-size:0.8rem;" id="btn-roll-p1"
              onclick="rollInitiative(1)">ROLL</button>
          </div>
          <div style="font-size:1.5rem; font-weight:bold;">VS</div>
          <div class="player-setup-box">
            <div>P2</div>
            <div class="roll-num" id="p2-roll">-</div>
            <button class="menu-btn" style="width:80px; font-size:0.8rem;" id="btn-roll-p2"
              onclick="rollInitiative(2)">ROLL</button>
          </div>
        </div>
        <div id="initiative-result" style="height:30px; color:var(--accent-color); font-weight:bold;"></div>
        <button class="menu-btn primary" id="btn-go-draw" style="display:none;" onclick="goToDraw()">前往抽卡</button>
      </div>

      <div id="step-draw" style="display:none;">
        <h3>抽取本場特殊卡 (各3張)</h3>
        <div style="display:flex; justify-content:center; gap:20px; margin:20px 0;">
          <div class="card-preview"
            style="width:120px; height:160px; justify-content:center; cursor:pointer; background:#444;"
            onclick="drawCardsAnimation()">
            <div style="font-size:3rem;">🎁</div>
            <div>點擊抽卡</div>
          </div>
        </div>
        <div id="draw-result-area" style="display:none;">
          <div style="font-size:0.9rem; margin-bottom:10px;">已獲得卡牌：</div>
          <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px; text-align:left;">
            <div>
              <div style="color:#d32f2f; font-size:0.8rem;">客隊手牌</div>
              <div id="vis-hand-list" style="font-size:0.8rem; color:#aaa;"></div>
            </div>
            <div>
              <div style="color:#1976d2; font-size:0.8rem;">主隊手牌</div>
              <div id="home-hand-list" style="font-size:0.8rem; color:#aaa;"></div>
            </div>
          </div>
          <button class="menu-btn primary" style="margin-top:20px;" onclick="startGameFromSetup()">開始比賽！</button>
        </div>
      </div>
    </div>
  </div>

  <!-- 新版跑燈機台 -->
  <div id="roll-overlay" class="overlay-screen hidden">
    <div class="machine-container">
      <div class="machine-title">RESULT TABLE</div>
      <div class="machine-dice-area">
        <div class="machine-die" id="m-d1">?</div>
        <div class="machine-die" id="m-d2">?</div>
      </div>
      <!-- 21格結果表 -->
      <div class="result-grid-v2" id="machine-grid">
        <!-- Generated by JS -->
      </div>
      <div style="margin-top:15px; color:#aaa; font-size:0.8rem;">等待跑燈停止...</div>
    </div>
  </div>

  <div class="game-wrapper blur" id="main-game">
    <header class="scoreboard">
      <div class="team-info">
        <div class="team-logo vis-logo">V</div>
        <div style="font-weight:bold; color:var(--vis-color)">VISITOR</div>
      </div>
      <div class="score-grid">
        <div class="cell header"></div>
        <div class="cell header">1</div>
        <div class="cell header">2</div>
        <div class="cell header">3</div>
        <div class="cell header">4</div>
        <div class="cell header">5</div>
        <div class="cell header">6</div>
        <div class="cell header">7</div>
        <div class="cell header">8</div>
        <div class="cell header">9</div>
        <div class="cell header total">R</div>

        <div class="cell team-name">VIS</div>
        <div class="cell active-score">0</div>
        <div class="cell">0</div>
        <div class="cell">0</div>
        <div class="cell">.</div>
        <div class="cell">.</div>
        <div class="cell">.</div>
        <div class="cell">.</div>
        <div class="cell">.</div>
        <div class="cell">.</div>
        <div class="cell total" id="score-vis-total">0</div>

        <div class="cell team-name">HOME</div>
        <div class="cell">.</div>
        <div class="cell">.</div>
        <div class="cell">.</div>
        <div class="cell">.</div>
        <div class="cell">.</div>
        <div class="cell">.</div>
        <div class="cell">.</div>
        <div class="cell">.</div>
        <div class="cell">.</div>
        <div class="cell total" id="score-home-total">0</div>
      </div>
      <div class="status-panel">
        <div class="bso-row">
          <span>B</span>
          <div class="lights">
            <div class="light" id="light-b1"></div>
            <div class="light" id="light-b2"></div>
            <div class="light" id="light-b3"></div>
          </div>
        </div>
        <div class="bso-row">
          <span>S</span>
          <div class="lights">
            <div class="light" id="light-s1"></div>
            <div class="light" id="light-s2"></div>
          </div>
        </div>
        <div class="bso-row">
          <span>O</span>
          <div class="lights">
            <div class="light" id="light-o1"></div>
            <div class="light" id="light-o2"></div>
          </div>
        </div>
        <div style="margin-top:4px; font-size:0.9rem; color:#fff;">1局上</div>
      </div>
    </header>

    <main class="main-area">
      <section class="field-container">
        <div class="field">
          <div class="mound"></div>
          <div class="infield-diamond rotated">
            <div class="base second"></div>
            <div class="base first"></div>
            <div class="base third"></div>
            <div class="base home"></div>
          </div>
          <div class="baseball" id="ball"></div>
          <div class="runner-dot" id="runner-0" style="display:none;"></div>
          <div class="runner-dot" id="runner-1"></div>
          <div class="runner-dot" id="runner-2"></div>
          <div class="runner-dot" id="runner-3"></div>
        </div>
      </section>

      <section class="interaction-panel">
        <div class="battle-slots">
          <div class="slot-box" id="slot-atk">
            <div class="slot-icon" id="icon-atk">⚔️</div>
            <div class="slot-label">攻方 ATK</div>
            <div class="slot-name" id="name-atk">等待選擇</div>
          </div>
          <div style="font-weight:900; font-style:italic; color:#555; font-size:1.5rem;">VS</div>
          <div class="slot-box" id="slot-def">
            <div class="slot-icon" id="icon-def">🛡️</div>
            <div class="slot-label">守方 DEF</div>
            <div class="slot-name" id="name-def">等待選擇</div>
          </div>
        </div>

        <div class="decks-container">
          <div class="deck-column" id="deck-col-vis">
            <div class="deck-header" style="color:var(--vis-color)">客隊手牌</div>
            <div id="vis-cards-area"></div>
          </div>
          <div class="deck-column" id="deck-col-home">
            <div class="deck-header" style="color:var(--home-color)">主隊手牌</div>
            <div id="home-cards-area"></div>
          </div>
        </div>

        <div class="controls">
          <div class="dice-display">
            <div class="die" id="d1">?</div>
            <div class="die" id="d2">?</div>
          </div>
          <div class="status-text">
            <div class="main-status" id="main-status">比賽開始</div>
            <div class="sub-status" id="sub-status">請雙方選擇卡牌或直接投球</div>
          </div>
          <button class="play-btn" id="play-btn" onclick="startTurn()">擲骰子 (ROLL)</button>
        </div>
      </section>
    </main>
  </div>

  <script src="constants.js"></script>
  <script src="main.js"></script>
</body>

</html>